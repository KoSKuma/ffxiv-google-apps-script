# Google Apps Script Development Rules

## Project Structure
- Use `.gs` extension for Google Apps Script files
- Use `.html` extension for HTML dialog/sidebar files
- Organize code into logical modules (one file per module/feature)
- Keep main entry points in `Code.gs` or `Main.gs`
- Use descriptive file names that reflect their purpose

## Code Style
- Follow JavaScript ES5/ES6 best practices (Apps Script supports modern JS)
- Use `const` and `let` instead of `var` when possible
- Use arrow functions where appropriate
- Prefer async/await over callbacks for asynchronous operations
- Use JSDoc comments for function documentation
- Keep functions focused and single-purpose
- Use meaningful variable and function names

## Google Apps Script Specific
- Always handle errors with try-catch blocks
- Use `SpreadsheetApp.getActiveSpreadsheet()` for active spreadsheet operations
- Cache frequently accessed data (ranges, values) to improve performance
- Use batch operations (getValues/setValues) instead of cell-by-cell operations
- Be mindful of execution time limits (6 minutes for regular scripts)
- Use triggers appropriately (onEdit, onOpen, time-driven, etc.)
- Always request minimal necessary permissions

## Best Practices
- Separate business logic from UI code
- Use configuration objects for settings instead of hardcoding values
- Implement proper error handling and logging
- Use `Logger.log()` for debugging (remove before production)
- Consider using `console.log()` for better debugging experience
- Document API calls and external dependencies
- Use meaningful constants for magic numbers and strings
- Implement input validation for user-facing functions

## File Organization
- Keep utility functions in separate files (e.g., `Utils.gs`, `Helpers.gs`)
- Group related functions together
- Use namespaces or object literals to organize related code
- Keep HTML templates in separate `.html` files

## Testing
- Create test functions for critical logic
- Use descriptive test function names (e.g., `testCalculateTotal`)
- Comment out or remove test code before deployment

## Deployment
- Never commit sensitive data (API keys, tokens, etc.)
- Use Script Properties for configuration that shouldn't be in code
- Document deployment steps in README
- Version your code appropriately

## Performance
- Minimize calls to SpreadsheetApp methods (cache results)
- Use batch operations whenever possible
- Avoid nested loops when working with large datasets
- Consider using Apps Script's built-in array methods (map, filter, reduce)

## Security
- Validate all user inputs
- Sanitize data before writing to sheets
- Use appropriate permission scopes
- Never log sensitive information

## Communication and Workflow
- **When answering questions**: Always answer the user's question first with a clear explanation
- **After answering**: Ask the user if they would like to update the code or documentation based on the answer
- **Do not assume**: Don't make code changes automatically when answering questions - wait for explicit confirmation
- **Provide context**: When explaining concepts, provide enough detail for understanding before suggesting changes
- **Separate concerns**: Keep explanations separate from implementation suggestions

## Date and Time Handling
- **When dates are needed**: Always check the current date/time using system commands if uncertain
  - Use `date +"%Y-%m-%d"` to get current date in YYYY-MM-DD format
  - Use `date +"%Y"` to get current year
  - Use `date +"%Y-%m-%d %H:%M:%S"` for full date and time
- **Date accuracy**: Never assume or guess dates - always verify the current date when:
  - Adding "Last Updated" dates to features in `FEATURE.md`
  - Adding completion dates to tasks in `TODO.md`
  - Creating new documentation entries with dates
  - Updating version information with dates
- **Date format**: Use ISO 8601 format (YYYY-MM-DD) for all dates in documentation
- **Year accuracy**: Pay special attention to the year - verify it matches the current year

## Documentation Maintenance
- **CRITICAL**: Update markdown documentation files when making significant changes
- **When reviewing/checking files**: If the user asks to "check", "review", "verify", or "is this up to date" for any file:
  - Compare the file content with the actual codebase implementation
  - Check for discrepancies between documentation and code
  - Verify all examples, function lists, and references are accurate
  - Update any outdated information found
  - Check related documentation files that might also need updates
  - Report what was found and what was updated
- When adding new functions: Update `API.md` with function documentation
- When adding new features: Update `ARCHITECTURE.md` with module information
- When changing workflows: Update `DEVELOPMENT.md` with new processes
- When modifying code style: Update `CONTRIBUTING.md` and `.cursorrules`
- When adding new patterns: Update `PROMPTS.md` with examples
- Keep `README.md` up to date with project structure and setup instructions
- **Feature Documentation**: Update `FEATURE.md` when making any changes to features
  - When adding a new feature: Add complete documentation using the feature template in `FEATURE.md`
  - When modifying an existing feature: Update the feature's documentation (parameters, behavior, examples)
  - When removing/deprecating a feature: Mark as ‚ùå Deprecated and move to appropriate section
  - When changing feature status: Update status indicator (‚úÖ Implemented, üü° In Progress, ‚¨ú Planned)
  - Include: function signature, parameters, return values, usage examples, how it works, and any notes
- **Task Tracking**: Update `TODO.md` when completing tasks, adding new features, or identifying work items
  - Mark completed tasks as ‚úÖ and move to "Completed Tasks" section
  - Add new tasks to appropriate sections (Current Sprint, Planned Features, Technical Debt, etc.)
  - Update task status (‚¨ú Not Started, üü° In Progress, ‚úÖ Completed, ‚ùå Cancelled)
- **Library Template Maintenance**: Update `LIBRARY_TEMPLATE.gs` when making changes to menu handlers in `Code.gs`
  - When modifying `onOpen()` function: Update the menu structure in `LIBRARY_TEMPLATE.gs`
  - When modifying menu handler functions (`menuLookupItemInfo`, `menuProcessItemList`, etc.): Update the corresponding functions in `LIBRARY_TEMPLATE.gs`
  - Keep the template identical to `Code.gs` menu handlers, but replace direct function calls with library calls (e.g., `lookupItemInfo()` ‚Üí `FFXIVTools.lookupItemInfo()`)
  - The template should mirror `Code.gs` menu handlers exactly, only changing function calls to use the library identifier
- Documentation should reflect the current state of the codebase
- If AI assistants are used, ensure they update relevant documentation files including `TODO.md`, `FEATURE.md`, and `LIBRARY_TEMPLATE.gs`
- Review documentation accuracy during code reviews

